---
title: "Database COVID/CASEN"
author: "Venegas, M & Lafferte, A"
date: "25 de abril de 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Ayudantía Estadística Multivariada: Creación de base de datos para insumo

El presente documento se enmarca en la realización de ayudantías para el ramo de Estadística Multivariada en su versión 2020 a cargo del profesor Juan Carlos Castilo.Este tiene por objetivo servir de ejemplo práctico para los estudiantes y motivar el uso de R en base a la exploración de situaciones contingentes.

En este documento se explorarán los datos respectivos al virus COVID - 19 y sus relaciones a nivel descriptivo con datos agregados a nivel comunal utilizando como fuente la Encuesta de Caracterización Socioeconomica (CASEN) 2017. El producto final del presente documento es una base de datos puesta a dispocisión para los/as estudiantes en el desarrollo de la guía práctica N°3.

El contenido que acá se presentará será dividido en tres secciones. La primera sección consistirá en la **limpieza y manejo de bases de datos**. Las acciones a realizar en esta primera sección serán las siguientes:

1) Se cargarán las bases de datos pertinentes para el ejercicio, a saber; base de datos de distribución de infectados con COVID 19 a nivel comunal y la CASEN 2017.
2) Se seleccionarán las variables acordes al ejercicio (por ejemplo, nivel socioeconomico, ingresos, edad, sexo etc.) y se renombrarán en caso de ser necesario.
3) En la base de datos de la CASEN 2017 se agruparán los datos a nivel comunal.
4) Se procederá a hacer un join con la base de datos del COVID 19 utilizando como llave la variable comuna.

La segunda sección consistirá en la realización de **descriptivos básicos** de variables de interés. Para esto se procederá de la siguiente manera:

1) Se eligirán comunas a trabajar en base a decisiones justificadas.
2) Se realizarán tablas de contingencia entre variables de interés y cantidad de contiagiados por comuna.
3) Se procederá a utilizar correlaciones r de pearson para conocer la relación entre variables de interés.

En la tercera y última sección se **reflexionarán** aspectos fundamentales sobre el manejo de datos hasta ahora trabajado y sobre las interpretaciones que se le pueden hacer a los descriptivos hechos.

## Primera sección: limpieza y manejo de bases de datos

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "hide")

```

En primer lugar, cargaremos los paquetes necesarios para el ejercicio
```{r}
# Cargar paquetes a utilizar
pacman::p_load(
               dplyr, 
               texreg,
               sJlabelled,
               readxl,
               xlsx,
               DescTools,
               psych,
               descr,
               expss,
               car,
               foreing
               )

```

Acto seguido, procedemos a cargar las bases de datos a utilizar
```{r}
#Base de datos COVID 19 al 25 de abril de 2020
BCV19C <- read.csv("CasosConfirmadosComuna.csv")

#Base de datos CASEN 2017
BCASEN <- read_spss("Casen 2017.sav")
```

Se seleccionan las variables a utilizar:
```{r}
#Desactivar notación cientifica
options(scipen=999)

#Selcción variables en CASEN 
BDCASEN_proc <- BCASEN %>% select (comuna, 
                                  edad, 
                                  sexo, 
                                  y1, 
                                  s12, 
                                  educ, 
                                  yoprcorh, 
                                  dau,
                                  ytotcorh)


#Se convierten los datos "99" a NA
BDCASEN_proc$s12[BDCASEN_proc$s12== 99] <- NA
BDCASEN_proc$educ[BDCASEN_proc$educ== 99] <- NA
BDCASEN_proc$y1[BDCASEN_proc$y1== 99] <- NA

BDCASEN_proc <-sjlabelled::copy_labels(BDCASEN_proc,BCASEN)
summary(BDCASEN_proc)

# Base de datos sin NA
BDCASEN_proc <-na.omit(BDCASEN_proc)
dim(BDCASEN_proc)
```


```{r}
#Etiquetación de variables CASEN. Base COVID 19 por comuna no requiere recodificación. 
BDCASEN_proc <- BDCASEN_proc %>% rename("comuna"=comuna, 
                                        "edad"=edad, 
                                        "ingreso"=y1, 
                                        "sexo"=sexo, 
                                        "educ"=educ, 
                                        "decilautonomo"=dau, 
                                        "sistemasalud"=s12, 
                                        "ingresocorregidoprincipal"=yoprcorh,
                                        "ingresohogar" =ytotcorh) 
View(BDCASEN_proc)
```

```{r}
#Media de ingreso individual por comuna
BDC1 <- BDCASEN_proc %>% 
  group_by(comuna) %>% 
  summarise(ingreso = mean(ingreso)) %>% 

#Media de ingreso hogar por comuna
BDC2 <- BDCASEN_proc %>% 
  group_by(comuna) %>% 
  summarise(ingresohogar = mean(ingresohogar))

#Media de edad por comuna
BDC3 <- BDCASEN_proc %>% 
  group_by(comuna) %>% 
  summarise(edad = mean(edad))

#Merges
BDC1y2 <- merge(BDC1, BDC2, by = "comuna")
BDC_all <- merge(BDC1y2, BDC3, by = "comuna")

```


BDCASEN_proc_1<- BDCASEN_proc %>% filter(sexo %in% 1)

BDC <- BDCASEN_proc %>% 
  group_by(comuna) %>% 
  summarise(sexo = sum(filter(sexo))

class(BDCASEN_proc$sexo)

#Nivel educacional por comuna

#Sistema de salud por comuna

#sexo por comuna

#decil por comuna
```


