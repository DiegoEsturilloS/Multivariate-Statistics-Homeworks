---
title: "Database COVID/CASEN"
author: "Venegas, M & Lafferte, A"
date: "25 de abril de 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Ayudant칤a Estad칤stica Multivariada: Creaci칩n de base de datos para insumo

El presente documento se enmarca en la realizaci칩n de ayudant칤as para el ramo de Estad칤stica Multivariada en su versi칩n 2020 a cargo del profesor Juan Carlos Castilo.Este tiene por objetivo servir de ejemplo pr치ctico para los estudiantes y motivar el uso de R en base a la exploraci칩n de situaciones contingentes.

En este documento se explorar치n los datos respectivos al virus COVID - 19 y sus relaciones a nivel descriptivo con datos agregados a nivel comunal utilizando como fuente la Encuesta de Caracterizaci칩n Socioeconomica (CASEN) 2017. El producto final del presente documento es una base de datos puesta a dispocisi칩n para los/as estudiantes en el desarrollo de la gu칤a pr치ctica N춿3.

El contenido que ac치 se presentar치 ser치 dividido en tres secciones. La primera secci칩n consistir치 en la **limpieza y manejo de bases de datos**. Las acciones a realizar en esta primera secci칩n ser치n las siguientes:

1) Se cargar치n las bases de datos pertinentes para el ejercicio, a saber; base de datos de distribuci칩n de infectados con COVID 19 a nivel comunal y la CASEN 2017.
2) Se seleccionar치n las variables acordes al ejercicio (por ejemplo, nivel socioeconomico, ingresos, edad, sexo etc.) y se renombrar치n en caso de ser necesario.
3) En la base de datos de la CASEN 2017 se agrupar치n los datos a nivel comunal.
4) Se proceder치 a hacer un join con la base de datos del COVID 19 utilizando como llave la variable comuna.

La segunda secci칩n consistir치 en la realizaci칩n de **descriptivos b치sicos** de variables de inter칠s. Para esto se proceder치 de la siguiente manera:

1) Se eligir치n comunas a trabajar en base a decisiones justificadas.
2) Se realizar치n tablas de contingencia entre variables de inter칠s y cantidad de contiagiados por comuna.
3) Se proceder치 a utilizar correlaciones r de pearson para conocer la relaci칩n entre variables de inter칠s.

En la tercera y 칰ltima secci칩n se **reflexionar치n** aspectos fundamentales sobre el manejo de datos hasta ahora trabajado y sobre las interpretaciones que se le pueden hacer a los descriptivos hechos.

## Primera secci칩n: limpieza y manejo de bases de datos





```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "hide")

```


```{r}
# Cargar paquetes a utilizar
pacman::p_load(lme4,
               reghelper,
               ggeffects,
               haven,
               stargazer,
               ggplot2, 
               dplyr, 
               texreg,
               ggeffects,
               corrplot,
               readxl,
               xlsx,
               lmerTest,
               sjlabelled,
               DescTools,
               psych,
               kableExtra,
               pander,
               descr,
               expss,
               car,
               foreing
               )




```


```{r}
BCV19C <- read.csv("CasosConfirmadosComuna.csv")

BCASEN <- read_spss("Casen 2017.sav")
```

```{r}
#Selcci칩n variables en CASEN 
options(scipen=999)

BDCASEN_proc <- BCASEN %>% select (comuna, 
                                  edad, 
                                  sexo, 
                                  y1, 
                                  s12, 
                                  educ, 
                                  yoprcorh, 
                                  dau,
                                  ytotcorh)



BDCASEN_proc$s12[BDCASEN_proc$s12== 99] <- NA
BDCASEN_proc$educ[BDCASEN_proc$educ== 99] <- NA
BDCASEN_proc$y1[BDCASEN_proc$y1== 99] <- NA
BDCASEN_proc <-na.omit(BDCASEN_proc)
dim(BDCASEN_proc)
BDCASEN_proc <-sjlabelled::copy_labels(BDCASEN_proc,BCASEN)
summary(BDCASEN_proc)
```


```{r}
#Etiquetaci칩n de variables CASEN. Base COVID 19 por comuna no requiere recodificaci칩n. 
BDCASEN_proc <- BDCASEN_proc %>% rename("comuna"=comuna, 
                                        "edad"=edad, 
                                        "ingreso"=y1, 
                                        "sexo"=sexo, 
                                        "educ"=educ, 
                                        "decilautonomo"=dau, 
                                        "sistemasalud"=s12, 
                                        "ingresocorregidoprincipal"=yoprcorh,
                                        "ingresohogar" =ytotcorh) 
View(BDCASEN_proc)
```


```{r}
#Creaci蚤 de variables de nivel 2 con Comuna

#Ingreso individual por comuna
ingresoindivcomuna <- BDCASEN_proc %>% data.frame() %>% select(comuna,ingreso)
class(BDCASEN_proc$ingreso)
ingresoindivcomunadf <- ingresoindivcomuna %>%group_by(comuna)%>%summarise(mean_ing_comuna=mean(ingreso,na.rm=TRUE))
BDCASEN_proc <- merge(BDCASEN_proc ,ingresoindivcomunadf ,by="comuna")
View(BDCASEN_proc$mean_ing_comuna)

#Ingreso hogar por comuna 
ingresohogarcomuna <- BDCASEN_proc %>% data.frame() %>% select(comuna, ingresohogar)
class(BDCASEN_proc$ingresohogar)
ingresohogarcomunadf <- ingresohogarcomuna %>%group_by(comuna)%>%summarise(mean_inghogar_comuna=mean(ingresohogar, na.rm=TRUE))
BDCASEN_proc <- merge(BDCASEN_proc ,ingresohogarcomunadf ,by="comuna")
View(BDCASEN_proc$mean_inghogar_comuna)

#edad por comuna
edadcomuna <- BDCASEN_proc %>% data.frame() %>% select(comuna,edad)
class(BDCASEN_proc$edad)
edadcomunadf <- edadcomuna %>%group_by(comuna)%>%summarise(mean_edad=mean(edad,na.rm=TRUE))
BDCASEN_proc <- merge(BDCASEN_proc, edadcomunadf, by="comuna")
View(BDCASEN_proc$mean_edad)


#Nivel educacional por comuna

#Sistema de salud por comuna

#sexo por comuna

#decil por comuna
```
